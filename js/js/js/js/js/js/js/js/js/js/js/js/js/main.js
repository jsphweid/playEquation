"use strict";function initializePlot(){myPlot=new Fooplot(document.getElementById("myPlot")),myPlot.ymax=1.1,myPlot.ymin=-1.1,myPlot.xmax=.01,myPlot.xmin=-.01,myPlot.reDraw()}function replaceAll(a,b,c){return a.replace(new RegExp(b,"g"),c)}function doEverything(a){displayMathJax.display(a),eqSet.clik(a),makeTone.begin()}var audioCtx=new(window.AudioContext||window.webkitAudioContext),myPlot;$(document).ready(function(){$("#equationInput").bind("keyup",function(a){13==a.keyCode&&(a.preventDefault(),doEverything(this.value))})}),window.onload=function(){initializePlot()};var eqSet={clik:function(a){a?(myPlot.deleteAllPlots(),myPlot.addPlot(a,FOOPLOT_TYPE_FUNCTION),myPlot.reDraw()):console.log("You've got to enter something!")}},fixEquation={st:"",replaceAll:function(a,b,c){return a.replace(new RegExp(b,"g"),c)},fix:function(a){return this.st=a,this.st=this.replaceAll(this.st,"FOOPLOT_MATH","Math"),this.st=this.replaceAll(this.st,"MATH","Math"),this.st=this.replaceAll(this.st,"vars.pi","Math.PI"),this.st=this.replaceAll(this.st,"vars.e","Math.E"),this.st=this.replaceAll(this.st,"vars.x","x"),this.st}},displayMathJax={display:function(a){var b=$("#mathJaxOutput");b.empty(),b.append("<p>`"+a+"`</p>"),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"mathJaxOutput"])}},makeTone={sampleRate:44100,clipLength:2,mostRecentSring:"",makeArray:function makeArray(parsedEquation){var ret=[];eval("var solveEquation = function(x) {return "+parsedEquation+"};");for(var i=0;i<this.sampleRate*this.clipLength;i++)ret.push(solveEquation(i/this.sampleRate));return ret},ADSR:function(a){for(var b=a.length-1,c=0;c<1e3;c++){var d=c/1e3;a[c]*=d,a[b]*=d,b--}return a},play:function(a){for(var b=2*audioCtx.sampleRate,c=audioCtx.createBuffer(1,b,audioCtx.sampleRate),d=c.getChannelData(0),e=$("#volSlider").val(),f=0;f<b;f++)d[f]=a[f]*e;var g=audioCtx.createBufferSource();g.buffer=c,g.connect(audioCtx.destination),g.start()},begin:function(){var a=fixEquation.fix(this.mostRecentSring),b=this.makeArray(a),c=this.ADSR(b);this.play(c)}};